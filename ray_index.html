<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CS 4621: PPA3 - Maze Crawler</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/cs4620.css" rel="stylesheet">
    <link href="css/jquery-ui.min.css" rel="stylesheet">
    <link href="css/jquery-ui.theme.min.css" rel="stylesheet">
    <link href="css/jquery-ui.structure.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/gl-matrix-min.js"></script>
    <script src="js/preloadjs-0.6.2.min.js"></script>
    
    <script src="ui.js" type="text/javascript"></script>
    <script src="renderer.js" type="text/javascript"></script>
</head>
<body>
<div class="container">
    <h1>CS 4621 PPA3 <span class="subtitle">Maze Crawler</span></h1>

    <div align="center">
        <canvas tabindex="1" id="webglCanvas" style="border:none; background-color:black;" width="800" height="600"></canvas>
    </div>

    <table class="table table-bordered">
        <tr>
            <td align="right"><b>Field of view:</b></td>
            <td><input type="text" id="fovSpinner" value="60.0" autocomplete="off"></td>
            <td align="right"><b>Eye height:</b></td>
            <td><input type="text" id="eyeHeightSpinner" value="0.5" autocomplete="off"></td>
        </tr>
        <tr>
            <td align="right"><b>Wall Bumpiness:</b></td>
            <td><input type="text" id="wallsBumpinessSpinner" value="2.0" autocomplete="off"></td>
            <td align="right"><b>Wall Roughness:</b></td>
            <td><input type="text" id="wallsRoughnessSpinner" value="5.0" autocomplete="off"></td>
        </tr>
        <tr>
            <td align="right"><b>Floor Bumpiness:</b></td>
            <td><input type="text" id="floorBumpinessSpinner" value="10.0" autocomplete="off"></td>
            <td align="right"><b>Floor Roughness:</b></td>
            <td><input type="text" id="floorRoughnessSpinner" value="0.0" autocomplete="off"></td>
        </tr>
        <tr>
            <td align="right"><b>Light Intensity:</b></td>
            <td><input type="text" id="lightBrightnessSpinner" value="200.0" autocomplete="off"></td>
            <td align="right"><b>Exposure:</b></td>
            <td><input type="text" id="exposureSpinner" value="1.0" autocomplete="off"></td>
        </tr>
        <tr>
            <td align="right"><b>Movement Speed: (tiles/sec)</b></td>
            <td><input type="text" id="movespeedSpinner" value="2.0" autocomplete="off"></td>
            <td align="right"><b>Rotation Speed: (rad/sec)</b></td>
            <td><input type="text" id="rotspeedSpinner" value="3.14159" autocomplete="off"></td>
        </tr>
        <tr>
            <td align="right"><b>Maze:</b></td>
            <td colspan="3">
<textarea style="font-family: monospace" id="mazeTextArea" cols="35" rows="10" autocomplete="off">
##############################
#...###................#.....#
#.#...#..........#####.......#
#.###.###............#.#.....#
#...#................#.#######
###.#.###....................#
#...#.....................#..#
#.#.###.#.................##.#
#N#.....#.................#$.#
##############################
</textarea>
                <br />
                <button id="updateMazeButton">Update Maze</button>
            </td>
        </tr>
    </table>

    <h3>Additional Feature Implemented</h3>
    <p>I implemented a cube map skybox and did diffuse/specular/normal texture shading and win squares and more UI elements.</p>

    <h3>Team Members</h3>
    <ul>
        <li>Ray Beck (rhb263)</li>
    </ul>
    
    <div style="height:24px;"></div>
</div>
    
    
<script id="main_vertex_program" type="x-shader/x-vertex">

uniform mat4 projectionMatrix;
uniform mat4 cameraMatrix;
uniform mat4 normalMatrix;

#define MAX_NUM_LIGHTS 9
uniform vec3 lightPositions[ MAX_NUM_LIGHTS ];
varying vec3 fLightPositions[ MAX_NUM_LIGHTS ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 tangent1;
attribute vec3 tangent2;
attribute vec2 uv;

varying vec4 fPosition;
varying vec3 fNormal;
varying vec3 fTangent1;
varying vec3 fTangent2;
varying vec2 fUV;

void main() {

    gl_Position = projectionMatrix * cameraMatrix * vec4(position, 1.0);
    
    for (int i = 0; i < MAX_NUM_LIGHTS; i++) {
        fLightPositions[i] = (cameraMatrix * vec4(lightPositions[i], 1.0)).xyz; }    
    
    fPosition = cameraMatrix * vec4(position, 1.0); fUV = uv;
    fNormal = normalize((normalMatrix * vec4(normal, 0.0)).xyz);
    fTangent1 = normalize((normalMatrix * vec4(tangent1, 0.0)).xyz);
    fTangent2 = normalize((normalMatrix * vec4(tangent2, 0.0)).xyz);    
}

</script>

<script id="main_fragment_program" type="x-shader/x-fragment">
    
precision highp float;

uniform sampler2D diffuseTexture;
uniform sampler2D specularTexture;
uniform sampler2D normalTexture;

#define MAX_NUM_LIGHTS 9
uniform vec3 lightColor;
varying vec3 fLightPositions[ MAX_NUM_LIGHTS ];

uniform float exposure;
uniform float roughness;
uniform float bumpiness;

varying vec4 fPosition;
varying vec3 fNormal;
varying vec3 fTangent1;
varying vec3 fTangent2;
varying vec2 fUV;

void main() { 

    vec3 V = normalize(-fPosition.xyz);
    vec3 N = normalize(fNormal);
    vec3 T1 = normalize(fTangent1);
    vec3 T2 = normalize(fTangent2);
        
    vec4 texN = texture2D(normalTexture, fUV);	
    vec3 realN = normalize(T1*(texN.r-0.5)*2.0*bumpiness + T2*(texN.g-0.5)*2.0*bumpiness + N*(texN.b-0.5)*2.0);
    
    vec3 finalColor = vec3(0.0, 0.0, 0.0);
    
    for (int i = 0; i < MAX_NUM_LIGHTS; i++) {

        if (fLightPositions[i] == vec3(0.0)) { continue; }

        float r = length(fLightPositions[i] - fPosition.xyz);
        vec3 L = normalize(fLightPositions[i] - fPosition.xyz); 
        vec3 H = normalize(L + V);

        vec3 Idiff = texture2D(diffuseTexture, fUV).rgb * max(dot(realN, L), 0.0);
        vec3 Ispec = texture2D(specularTexture, fUV).rgb * pow(max(dot(realN, H), 0.0), 1.0 / roughness);

        finalColor += lightColor * (Idiff + Ispec) / (r*r);
    }
    
    gl_FragColor = vec4(finalColor * exposure, 1.0);
}

</script>

<script id="skybox_vertex_program" type="x-shader/x-vertex">

uniform mat4 projectionMatrix;
uniform mat4 cameraMatrix;

attribute vec3 position;
varying vec3 fPosition;

void main() {
    fPosition = position;
    gl_Position = projectionMatrix * cameraMatrix * vec4(position, 1.0);
}

</script>

<script id="skybox_fragment_program" type="x-shader/x-fragment">
    
precision highp float;

uniform samplerCube skyboxTexture;
uniform float exposure;
varying vec3 fPosition;

void main() { 
    gl_FragColor = vec4(textureCube(skyboxTexture, fPosition).rgb * exposure, 1.0);
}

</script>

</body>
</html>